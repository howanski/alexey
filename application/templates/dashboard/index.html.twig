{% extends 'base.html.twig' %}

{% block title %}Alexey | Dashboard
{% endblock %}

{% block javascripts %}
	{{ parent() }}
	<script>
		setTimeout(() => {
window.location.reload(false);
}, {{ dashboard_data.refresh_time }});
	</script>
{% endblock %}

{% block pageContent %}
	<div class="d-sm-flex align-items-center justify-content-between mb-4">
		<h1 class="h3 mb-0 text-gray-400">{{ 'app.dashboard'|trans }}</h1>
	</div>
	{% if dashboard_data.machines|length > 0 %}
		<div class="row">
			<h5 class="text-gray-400">{{ 'app.network_machines'|trans }}</h1>
		</div>
		<div class="row">
			{% for machine in dashboard_data.machines %}
				<div class="col-xl-3 col-md-6 mb-4">
					<div class="card {% if machine.isReachable %} border-left-success {% elseif machine.lastSeen %} border-left-warning {% else %} border-left-danger {% endif %} shadow h-100 py-2">
						<div class="card-body">
							<div class="row no-gutters align-items-center">
								<div class="col mr-2">
									<div class="text-xs font-weight-bold {% if machine.isReachable %} text-success {% elseif machine.lastSeen %} text-warning {% else %} text-danger {% endif %} text-uppercase mb-1">
										{{ 'app.network_machines.machine'|trans }}:
										{{ machine.name }}</div>
									{% if machine.lastSeen %}
										<div class="h5 mb-0 font-weight-bold text-gray-800">{{ 'app.network_machines.last_seen'|trans }}
											{{ machine.getLastSeenReadable(app.request.locale) }}</div>
									{% endif %}
								</div>
								<div class="col-auto">
									{% if machine.canBeWoken %}
										<a href="{{ path('network_machine_wake', {'id': machine.id, 'backRoute': 'dashboard'}) }}">
											<i class="fas fa-power-off fa-2x text-success"></i>
										</a>
									{% else %}
										<i class="fas fa-server fa-2x text-gray-300"></i>
									{% endif %}
								</div>
							</div>
						</div>
					</div>
				</div>
			{% endfor %}
		</div>
	{% endif %}
	{# TODO: refactor cards #}
	{% if dashboard_data.network_statistic is defined and dashboard_data.network_statistic is not null %}
		<div class="row">
			<h5 class="text-gray-400">{{ 'app.network_usage'|trans }}</h1>
		</div>
		<div class="row">
			<div class="col-xl-3 col-md-6 mb-4">
				<div class="card  border-left-success shadow h-100 py-2">
					<div class="card-body">
						<div class="row no-gutters align-items-center">
							<div class="col mr-2">
								<div class="text-xs font-weight-bold  text-success text-uppercase mb-1">
									{{ 'app.network.network_usage.optimal_speed'|trans }}:
								</div>
								<div class="h5 mb-0 font-weight-bold text-gray-800">{{ dashboard_data.network_statistic.getTransferRateLeftReadable(4) }}</div>
							</div>
							<div class="col-auto">
								<a href="{{ path('network_usage') }}">
									<i class="far fa-eye fa-2x text-success"></i>
								</a>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="col-xl-3 col-md-6 mb-4">
				<div class="card  border-left-success shadow h-100 py-2">
					<div class="card-body">
						<div class="row no-gutters align-items-center">
							<div class="col mr-2">
								<div class="text-xs font-weight-bold  text-success text-uppercase mb-1">
									{{ 'app.network.network_usage.traffic_left'|trans }}:
								</div>
								<div class="h5 mb-0 font-weight-bold text-gray-800">{{ dashboard_data.network_statistic.getTrafficLeftReadable(4) }}</div>
							</div>
							<div class="col-auto">
								<a href="{{ path('network_usage') }}">
									<i class="far fa-eye fa-2x text-success"></i>
								</a>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="col-xl-3 col-md-6 mb-4">
				<div class="card  border-left-success shadow h-100 py-2">
					<div class="card-body">
						<div class="row no-gutters align-items-center">
							<div class="col mr-2">
								<div class="text-xs font-weight-bold  text-success text-uppercase mb-1">
									{{ 'app.network.network_usage.billing_window_end'|trans }}:
								</div>
								<div class="h5 mb-0 font-weight-bold text-gray-800">{{ dashboard_data.network_statistic.timeFrame.getBillingFrameEndReadable(app.request.locale) }}</div>
							</div>
							<div class="col-auto">
								<a href="{{ path('network_usage') }}">
									<i class="far fa-eye fa-2x text-success"></i>
								</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	{% endif %}
	{% if dashboard_data.weather is defined and dashboard_data.weather is not null %}
		<div class="row">
			<h5 class="text-gray-400">{{ 'app.weather'|trans }}</h1>
		</div>
		<div class="row">
			{% for weather in dashboard_data.weather.getWeatherReadable().daily|slice(0, 4) %}
				<div class="col-xl-3 col-md-6 mb-4">
					<div class="card {% if weather.rain > 20  %} border-left-danger {% elseif weather.rain > 0  %} border-left-warning {% else %} border-left-success {% endif %} shadow h-100 py-2">
						<div class="card-body">
							<div class="row no-gutters align-items-center">
								<div class="col mr-2">
									<div class="text-xs font-weight-bold {% if weather.rain > 20  %} text-danger {% elseif weather.rain > 0  %} text-warning {% else %} text-success {% endif %} text-uppercase mb-1">
										{{ weather.date }}
									</div>
									<div class="h5 mb-0 font-weight-bold text-gray-500">
										{{ weather.weather }}
										<br>{{ weather.temperature }}
										Â°C
										{% if weather.rain > 0  %}<br>Rain:
											{{ weather.rain }} mm
										{% endif %}
									</div>
								</div>
								<div class="col-auto">
									<img src="http://openweathermap.org/img/wn/{{ weather.weather_icon }}@2x.png">
								</div>
							</div>
						</div>
					</div>
				</div>
			{% endfor %}
		</div>
	{% endif %}
{% endblock %}
