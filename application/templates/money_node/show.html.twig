{% extends 'base.html.twig' %}
{% set breadcrumbs = [
	{'name': 'menu_record'|localised('money')},
	{'name': 'menu_record_nodes'|localised('money'), 'href': path('money_node_index')},
	{'name': money_node.name },
	]
%}

{% block pageContentPrimary %}
	{% include 'table.html.twig'
		with {
			'tableTitle' : money_node.name,
			'tableData': [
                ['id'|localised, money_node.id ],
                ['name'|localisedFormLabel('money'), money_node.name ],
                ['node_type'|localisedFormLabel('money'), money_node.typeCode|localisedFormValue('node_type', 'money') ],
                ['node_group'|localisedFormLabel('money'), settings.groupName(money_node.nodeGroup) ],
                ['balance'|localised('money'), money_node.balance ],
                ['notes'|localisedFormLabel('money'), money_node.notes ],
            ],
		} only
	%}
{% endblock %}
{% block pageContentSecondary %}
	{% set actionButtons = [
        {
            'color': 'nord10',
            'href': path('money_node_index', {'groupId': money_node.nodeGroup}),
            'name': 'back_to_list'|localised,
            'icon': 'fas fa-undo'
        },
        {
            'color': 'nord12',
            'href': path('money_node_edit', {'id': money_node.id}),
            'name': 'edit'|localised,
            'icon': 'far fa-edit'
        }
        ]
    %}
	{% if money_node.canBeDeleted %}
		{% set securedButtons = [
        {
            'color': 'nord11',
            'name': 'delete'|localised,
            'icon': 'fas fa-trash',
            'action': path('money_node_delete', {'id': money_node.id}),
            'csrf': csrf_token('delete' ~ money_node.id),
            'confirmation': 'you_sure_delete'|localised
        }
        ]
    %}
	{% else %}
		{% set securedButtons = [] %}
	{% endif %}
	{% include 'entity_actions_row.html.twig' with {'buttons': actionButtons, 'securedButtons': securedButtons} only %}

	{% set tableData = [] %}
	{% for transfer in money_node.incomingTransfers %}
		{% set actions %}
		{% include 'table_action_button.html.twig' with {'href': path('money_transfer_show', {'id': transfer.id}), 'name': 'show_transfer'|localised('money') } only %}
		{% include 'table_action_button.html.twig' with {'href': path('money_node_show', {'id': transfer.sourceNode.id}), 'name': 'show_node'|localised('money') } only %}
		{% endset %}
		{% set tableData = tableData|merge([{
				'operation_date': transfer.operationDate|date('Y-m-d'),
				'amount': transfer.amount,
				'opposite_node': transfer.sourceNode.name,
				'comment': transfer.comment,
				'actions': actions,
		}]) %}
	{% endfor %}

	{% include 'table.html.twig'
		with {
			'tableTitle' : 'incoming_transfers'|localised('money'),
			'tableData': tableData,
			'tableHeaders': [
				'operation_date'|localisedFormLabel('money'),
				'amount'|localisedFormLabel('money'),
				'source_node'|localisedFormLabel('money'),
				'comment'|localisedFormLabel('money'),
				'actions'|localised,
			]
		} only
	%}


	{% set tableData = [] %}
	{% for transfer in money_node.outgoingTransfers %}
		{% set actions %}
		{% include 'table_action_button.html.twig' with {'href': path('money_transfer_show', {'id': transfer.id}), 'name': 'show_transfer'|localised('money') } only %}
		{% include 'table_action_button.html.twig' with {'href': path('money_node_show', {'id': transfer.targetNode.id}), 'name': 'show_node'|localised('money') } only %}
		{% endset %}
		{% set tableData = tableData|merge([{
				'operation_date': transfer.operationDate|date('Y-m-d'),
				'amount': transfer.amount,
				'opposite_node': transfer.targetNode.name,
				'comment': transfer.comment,
				'actions': actions,
		}]) %}
	{% endfor %}
	{% include 'table.html.twig'
		with {
			'tableTitle' : 'outgoing_transfers'|localised('money'),
			'tableData': tableData,
			'tableHeaders': [
				'operation_date'|localisedFormLabel('money'),
				'amount'|localisedFormLabel('money'),
				'target_node'|localisedFormLabel('money'),
				'comment'|localisedFormLabel('money'),
				'actions'|localised,
			]
		} only
	%}
{% endblock %}
